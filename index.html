<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Encryption</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f4f7fc;
        }

        .container {
            width: 100%;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            text-align: center;
            color: #333;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input[type="file"],
        input[type="password"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        #downloadLink {
            text-align: center;
            margin-top: 20px;
        }

        .error-message {
            color: red;
            text-align: center;
            font-weight: bold;
        }

        .success-message {
            color: green;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Encrypt a File</h2>
        <form id="encryptForm">
            <label for="fileInput">Select File:</label>
            <input type="file" id="fileInput" required>
            <label for="passwordInput">Enter Password:</label>
            <input type="password" id="passwordInput" required>
            <button type="submit">Encrypt</button>
        </form>

        <h2>Decrypt a File</h2>
        <form id="decryptForm">
            <label for="decryptFileInput">Select Encrypted File:</label>
            <input type="file" id="decryptFileInput" required>
            <label for="decryptPasswordInput">Enter Password:</label>
            <input type="password" id="decryptPasswordInput" required>
            <button type="submit">Decrypt</button>
        </form>

        <div id="downloadLink"></div>
        <div class="error-message" id="errorMessage" style="display:none;"></div>
        <div class="success-message" id="successMessage" style="display:none;"></div>
    </div>

    <script>
        // Convert a file to Base64 string
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = function() {
                    resolve(reader.result.split(',')[1]); // Return Base64 encoded string without the data URL prefix
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Encrypt the file
        document.getElementById('encryptForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const fileInput = document.getElementById('fileInput');
            const passwordInput = document.getElementById('passwordInput');
            const file = fileInput.files[0];
            const password = passwordInput.value;

            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const downloadLink = document.getElementById('downloadLink');

            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            downloadLink.innerHTML = '';

            if (!file || !password) {
                errorMessage.textContent = 'Please select a file and enter a password.';
                errorMessage.style.display = 'block';
                return;
            }

            try {
                // Convert file to Base64 string
                const fileBase64 = await fileToBase64(file);

                // Encrypt the Base64 string using AES
                const encrypted = CryptoJS.AES.encrypt(fileBase64, password).toString();

                // Create a Blob with the encrypted content and trigger download
                const blob = new Blob([encrypted], { type: 'application/octet-stream' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = file.name + '.enc'; // Save as .enc file
                link.click();

                successMessage.textContent = 'File encrypted successfully! Downloading...';
                successMessage.style.display = 'block';
            } catch (error) {
                errorMessage.textContent = 'Error during encryption. Please try again.';
                errorMessage.style.display = 'block';
            }
        });

        // Decrypt the file
        document.getElementById('decryptForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const decryptFileInput = document.getElementById('decryptFileInput');
            const decryptPasswordInput = document.getElementById('decryptPasswordInput');
            const file = decryptFileInput.files[0];
            const password = decryptPasswordInput.value;

            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const downloadLink = document.getElementById('downloadLink');

            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            downloadLink.innerHTML = '';

            if (!file || !password) {
                errorMessage.textContent = 'Please select an encrypted file and enter a password.';
                errorMessage.style.display = 'block';
                return;
            }

            try {
                // Read encrypted file content as text (Base64 string)
                const reader = new FileReader();
                reader.onload = function(e) {
                    const encryptedBase64 = e.target.result;

                    // Decrypt the Base64 string using AES
                    const decryptedBytes = CryptoJS.AES.decrypt(encryptedBase64, password);
                    const decryptedData = decryptedBytes.toString(CryptoJS.enc.Utf8);

                    if (!decryptedData) {
                        errorMessage.textContent = 'Wrong password or corrupted file!';
                        errorMessage.style.display = 'block';
                        return;
                    }

                    // Convert decrypted data (Base64 string) back to binary
                    const byteCharacters = atob(decryptedData);  // Decode Base64 back to binary
                    const byteArrays = [];

                    for (let offset = 0; offset < byteCharacters.length; offset += 512) {
                        const slice = byteCharacters.slice(offset, offset + 512);
                        const byteNumbers = new Array(slice.length);
                        for (let i = 0; i < slice.length; i++) {
                            byteNumbers[i] = slice.charCodeAt(i);
                        }
                        byteArrays.push(new Uint8Array(byteNumbers));
                    }

                    const blob = new Blob(byteArrays, { type: 'application/octet-stream' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = file.name.replace('.enc', ''); // Remove .enc extension
                    link.click();

                    successMessage.textContent = 'File decrypted successfully! Downloading...';
                    successMessage.style.display = 'block';
                };
                reader.readAsText(file); // Read file as text (Base64 encoded string)
            } catch (error) {
                errorMessage.textContent = 'Error decrypting the file!';
                errorMessage.style.display = 'block';
            }
        });
    </script>
</body>
</html>
