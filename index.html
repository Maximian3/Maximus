<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Encryption</title>
    <script src="crypto-js.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Press Start 2P', cursive;
            background-color: #1e1e1e;
            color: #00FF00;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            background-color: #333;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            box-sizing: border-box;
            border: 2px solid #00FF00;
        }

        h2 {
            text-align: center;
            color: #ff0000;
            font-weight: normal;
            font-size: 28px;
            text-transform: uppercase;
            margin-bottom: 20px;
        }

        h3 {
            color: #ffd500;
            font-size: 22px;
            text-align: center;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #00FF00;
            font-size: 14px;
        }

        input[type="file"],
        input[type="password"] {
            width: 94%;
            padding: 12px;
            margin-bottom: 18px;
            border: 1px solid #00FF00;
            border-radius: 8px;
            font-size: 16px;
            background-color: #222;
            color: #00FF00;
        }

        input[type="file"]:focus,
        input[type="password"]:focus {
            border-color: #FFD700;
            outline: none;
        }

        button {
            width: 99%;
            padding: 12px;
            background-color: #00FF00;
            color: #1e1e1e;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #FFD700;
        }

        #downloadLink {
            text-align: center;
            margin-top: 20px;
        }

        .errormessage,
        .successMessage {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .errorMessage {
            background-color: #ff0000;
            color: white;
        }

        .successMessage {
            background-color: #228B22;
            color: white;
        }

        .form-section {
            margin-bottom: 40px;
            border-bottom: 2px dashed #00FF00;
            padding-bottom: 20px;
        }

        .hidden {
            display: none;
        }
        /* cyrillic-ext */
        @font-face {
            font-family: 'Press Start 2P';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nYivNm4I81PZQ.woff2) format('woff2');
            unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
        }
        /* cyrillic */
        @font-face {
            font-family: 'Press Start 2P';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nRivNm4I81PZQ.woff2) format('woff2');
            unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
        }
        /* greek */
        @font-face {
            font-family: 'Press Start 2P';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nWivNm4I81PZQ.woff2) format('woff2');
            unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
        }
        /* latin-ext */
        @font-face {
            font-family: 'Press Start 2P';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nbivNm4I81PZQ.woff2) format('woff2');
            unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
        }
        /* latin */
        @font-face {
            font-family: 'Press Start 2P';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nVivNm4I81.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>File Encryption & Decryption</h2>

        <div class="form-section">
            <h3>Encrypt a File</h3>
            <form id="encryptForm">
                <label for="fileInput">Select File:</label>
                <input type="file" id="fileInput" required>
                <label for="passwordInput">Enter Password:</label>
                <input type="password" id="passwordInput" required>
                <button type="submit">Encrypt</button>
            </form>
        </div>

        <div class="form-section">
            <h3>Decrypt a File</h3>
            <form id="decryptForm">
                <label for="decryptFileInput">Select Encrypted File:</label>
                <input type="file" id="decryptFileInput" required>
                <label for="decryptPasswordInput">Enter Password:</label>
                <input type="password" id="decryptPasswordInput" required>
                <button type="submit">Decrypt</button>
            </form>
        </div>

        <div id="downloadLink"></div>
        <div class="error-message hidden" id="errorMessage"></div>
        <div class="success-message hidden" id="successMessage"></div>
    </div>

    <script>
        // Convert a file to Base64 string
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = function() {
                    resolve(reader.result.split(',')[1]); // Return Base64 encoded string without the data URL prefix
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Encrypt the file
        document.getElementById('encryptForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const fileInput = document.getElementById('fileInput');
            const passwordInput = document.getElementById('passwordInput');
            const file = fileInput.files[0];
            const password = passwordInput.value;

            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const downloadLink = document.getElementById('downloadLink');

            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            downloadLink.innerHTML = '';

            if (!file || !password) {
                errorMessage.textContent = 'Please select a file and enter a password.';
                errorMessage.style.display = 'block';
                return;
            }

            try {
                // Convert file to Base64 string
                const fileBase64 = await fileToBase64(file);

                // Encrypt the Base64 string using AES
                const encrypted = CryptoJS.AES.encrypt(fileBase64, password).toString();

                // Create a Blob with the encrypted content and trigger download
                const blob = new Blob([encrypted], { type: 'application/octet-stream' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = file.name + '.enc'; // Save as .enc file
                link.click();

                successMessage.textContent = 'File encrypted successfully! Downloading...';
                successMessage.style.display = 'block';
                // Hide the success message after 4 seconds
                setTimeout(function() {
                    successMessage.style.display = 'none';
                }, 4000); // 4000 ms = 4 seconds
            } catch (error) {
                errorMessage.textContent = 'Error during encryption. Please try again.';
                errorMessage.style.display = 'block';
            }
        });

        // Decrypt the file
        document.getElementById('decryptForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const decryptFileInput = document.getElementById('decryptFileInput');
            const decryptPasswordInput = document.getElementById('decryptPasswordInput');
            const file = decryptFileInput.files[0];
            const password = decryptPasswordInput.value;

            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const downloadLink = document.getElementById('downloadLink');

            errorMessage.classList.add('hidden');
            successMessage.classList.add('hidden');
            downloadLink.innerHTML = '';

            if (!file || !password) {
                errorMessage.textContent = 'Please select an encrypted file and enter a password.';
                errorMessage.classList.remove('hidden');
                return;
            }

            try {
                // Read encrypted file content as text (Base64 string)
                const reader = new FileReader();
                reader.onload = function(e) {
                    const encryptedBase64 = e.target.result;

                    // Decrypt the Base64 string using AES
                    const decryptedBytes = CryptoJS.AES.decrypt(encryptedBase64, password);
                    const decryptedData = decryptedBytes.toString(CryptoJS.enc.Utf8);

                    // Check if decryption failed
                    if (!decryptedData || decryptedData === "") {
                        errorMessage.textContent = 'Wrong password or corrupted file!';
                        errorMessage.classList.remove('hidden');
                        return;
                    }

                    // Convert decrypted data (Base64 string) back to binary
                    const byteCharacters = atob(decryptedData);  // Decode Base64 back to binary
                    const byteArrays = [];

                    for (let offset = 0; offset < byteCharacters.length; offset += 512) {
                        const slice = byteCharacters.slice(offset, offset + 512);
                        const byteNumbers = new Array(slice.length);
                        for (let i = 0; i < slice.length; i++) {
                            byteNumbers[i] = slice.charCodeAt(i);
                        }
                        byteArrays.push(new Uint8Array(byteNumbers));
                    }

                    const blob = new Blob(byteArrays, { type: 'application/octet-stream' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = file.name.replace('.enc', ''); // Remove .enc extension
                    link.click();

                    successMessage.textContent = 'File decrypted successfully! Downloading...';
                    successMessage.classList.remove('hidden');
                    setTimeout(function() {
                        successMessage.style.display = 'none';
                    }, 4000); // 4000 ms = 4 seconds
                };

                reader.onerror = function() {
                    errorMessage.textContent = 'Error reading the file!';
                    errorMessage.classList.remove('hidden');
                };

                reader.readAsText(file); // Read file as text (Base64 encoded string)
            } catch (error) {
                errorMessage.textContent = 'Error decrypting the file!';
                errorMessage.classList.remove('hidden');
            }
        });

    
    </script>
</body>
</html>
